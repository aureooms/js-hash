<!DOCTYPE html><html lang="en"><head><title>md5</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content=""><meta name="groc-document-path" content="md5"><meta name="groc-project-path" content="js/src/md5.js"><meta name="groc-github-url" content="https://github.com/aureooms/js-hash"><link rel="stylesheet" type="text/css" media="all" href="assets/style.css"><script type="text/javascript" src="assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/aureooms/js-hash/blob/master/js/src/md5.js">js/src/md5.js</a></div></div><div id="document"><div class="segment"></div><div class="segment"><div class="comments "><div class="wrapper"><p>MD5</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">var</span> md5 = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(bytes, n, digest)</span> {</span>

	<span class="hljs-keyword">var</span> k, r, h, last, z, zeroes, j, m, o, q, y, tail, u;

	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rot</span> <span class="hljs-params">(word, shift)</span> {</span>
		<span class="hljs-keyword">return</span> (word &lt;&lt; shift) | (word &gt;&gt;&gt; (<span class="hljs-number">32</span> - shift));
	}

	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add32</span> <span class="hljs-params">(a, b)</span> {</span>
		<span class="hljs-keyword">return</span> (a + b) &amp; <span class="hljs-number">0xffffffff</span>;
	}

	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">lil32</span> <span class="hljs-params">(a, o)</span> {</span>
		<span class="hljs-keyword">return</span> (a[o + <span class="hljs-number">3</span>] &lt;&lt; <span class="hljs-number">24</span>) |
		       (a[o + <span class="hljs-number">2</span>] &lt;&lt; <span class="hljs-number">16</span>) |
		       (a[o + <span class="hljs-number">1</span>] &lt;&lt;  <span class="hljs-number">8</span>) |
		        a[o + <span class="hljs-number">0</span>];
	}

	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cycle</span> <span class="hljs-params">(h, k, r, w)</span> {</span>

		<span class="hljs-keyword">var</span> i, f, g, a, b, c, d, t;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>initialize hash value for this chunk:</p></div></div><div class="code"><div class="wrapper">		a = h[<span class="hljs-number">0</span>];
		b = h[<span class="hljs-number">1</span>];
		c = h[<span class="hljs-number">2</span>];
		d = h[<span class="hljs-number">3</span>];</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>main loop</p></div></div><div class="code"><div class="wrapper">		<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">64</span>; ++i) {

			<span class="hljs-keyword">if</span> (i &lt; <span class="hljs-number">16</span>) {
				f = (b &amp; c) | ((~ b) &amp; d);
				g = i;
			}
			<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i &lt; <span class="hljs-number">32</span>) {
				f = (d &amp; b) | ((~ d) &amp; c);
				g = (<span class="hljs-number">5</span> * i + <span class="hljs-number">1</span>) % <span class="hljs-number">16</span>;
			}
			<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i &lt; <span class="hljs-number">48</span>) {
				f = b ^ c ^ d;
				g = (<span class="hljs-number">3</span> * i + <span class="hljs-number">5</span>) % <span class="hljs-number">16</span>;
			}
			<span class="hljs-keyword">else</span> {
				f = c ^ (b | (~ d));
				g = (<span class="hljs-number">7</span> * i) % <span class="hljs-number">16</span>;
			}


			t = d;
			d = c;
			c = b;
			b = add32(b, rot(add32(add32(a, f), add32(k[i], w[g])) , r[i]));
			a = t;
		}</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Add this chunk&#39;s hash to result so far:</p></div></div><div class="code"><div class="wrapper">		h[<span class="hljs-number">0</span>] = add32(h[<span class="hljs-number">0</span>], a);
		h[<span class="hljs-number">1</span>] = add32(h[<span class="hljs-number">1</span>], b);
		h[<span class="hljs-number">2</span>] = add32(h[<span class="hljs-number">2</span>], c);
		h[<span class="hljs-number">3</span>] = add32(h[<span class="hljs-number">3</span>], d);
	}

	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">call</span> <span class="hljs-params">(h, k, r, data, o)</span> {</span>

		<span class="hljs-keyword">var</span> w;

		<span class="hljs-comment">//break chunk into sixteen 32-bit little-endian words w[i], 0 ≤ i ≤ 15</span>


		w = [
			lil32(data, o +  <span class="hljs-number">0</span>),
			lil32(data, o +  <span class="hljs-number">4</span>),
			lil32(data, o +  <span class="hljs-number">8</span>),
			lil32(data, o + <span class="hljs-number">12</span>),
			lil32(data, o + <span class="hljs-number">16</span>),
			lil32(data, o + <span class="hljs-number">20</span>),
			lil32(data, o + <span class="hljs-number">24</span>),
			lil32(data, o + <span class="hljs-number">28</span>),
			lil32(data, o + <span class="hljs-number">32</span>),
			lil32(data, o + <span class="hljs-number">36</span>),
			lil32(data, o + <span class="hljs-number">40</span>),
			lil32(data, o + <span class="hljs-number">44</span>),
			lil32(data, o + <span class="hljs-number">48</span>),
			lil32(data, o + <span class="hljs-number">52</span>),
			lil32(data, o + <span class="hljs-number">56</span>),
			lil32(data, o + <span class="hljs-number">60</span>)
		];


		cycle(h, k, r, w);
	}

	k = [
		<span class="hljs-number">0xd76aa478</span>, <span class="hljs-number">0xe8c7b756</span>, <span class="hljs-number">0x242070db</span>, <span class="hljs-number">0xc1bdceee</span> ,
		<span class="hljs-number">0xf57c0faf</span>, <span class="hljs-number">0x4787c62a</span>, <span class="hljs-number">0xa8304613</span>, <span class="hljs-number">0xfd469501</span> ,
		<span class="hljs-number">0x698098d8</span>, <span class="hljs-number">0x8b44f7af</span>, <span class="hljs-number">0xffff5bb1</span>, <span class="hljs-number">0x895cd7be</span> ,
		<span class="hljs-number">0x6b901122</span>, <span class="hljs-number">0xfd987193</span>, <span class="hljs-number">0xa679438e</span>, <span class="hljs-number">0x49b40821</span> ,
		<span class="hljs-number">0xf61e2562</span>, <span class="hljs-number">0xc040b340</span>, <span class="hljs-number">0x265e5a51</span>, <span class="hljs-number">0xe9b6c7aa</span> ,
		<span class="hljs-number">0xd62f105d</span>, <span class="hljs-number">0x02441453</span>, <span class="hljs-number">0xd8a1e681</span>, <span class="hljs-number">0xe7d3fbc8</span> ,
		<span class="hljs-number">0x21e1cde6</span>, <span class="hljs-number">0xc33707d6</span>, <span class="hljs-number">0xf4d50d87</span>, <span class="hljs-number">0x455a14ed</span> ,
		<span class="hljs-number">0xa9e3e905</span>, <span class="hljs-number">0xfcefa3f8</span>, <span class="hljs-number">0x676f02d9</span>, <span class="hljs-number">0x8d2a4c8a</span> ,
		<span class="hljs-number">0xfffa3942</span>, <span class="hljs-number">0x8771f681</span>, <span class="hljs-number">0x6d9d6122</span>, <span class="hljs-number">0xfde5380c</span> ,
		<span class="hljs-number">0xa4beea44</span>, <span class="hljs-number">0x4bdecfa9</span>, <span class="hljs-number">0xf6bb4b60</span>, <span class="hljs-number">0xbebfbc70</span> ,
		<span class="hljs-number">0x289b7ec6</span>, <span class="hljs-number">0xeaa127fa</span>, <span class="hljs-number">0xd4ef3085</span>, <span class="hljs-number">0x04881d05</span> ,
		<span class="hljs-number">0xd9d4d039</span>, <span class="hljs-number">0xe6db99e5</span>, <span class="hljs-number">0x1fa27cf8</span>, <span class="hljs-number">0xc4ac5665</span> ,
		<span class="hljs-number">0xf4292244</span>, <span class="hljs-number">0x432aff97</span>, <span class="hljs-number">0xab9423a7</span>, <span class="hljs-number">0xfc93a039</span> ,
		<span class="hljs-number">0x655b59c3</span>, <span class="hljs-number">0x8f0ccc92</span>, <span class="hljs-number">0xffeff47d</span>, <span class="hljs-number">0x85845dd1</span> ,
		<span class="hljs-number">0x6fa87e4f</span>, <span class="hljs-number">0xfe2ce6e0</span>, <span class="hljs-number">0xa3014314</span>, <span class="hljs-number">0x4e0811a1</span> ,
		<span class="hljs-number">0xf7537e82</span>, <span class="hljs-number">0xbd3af235</span>, <span class="hljs-number">0x2ad7d2bb</span>, <span class="hljs-number">0xeb86d391</span>
	];

	r = [
		<span class="hljs-number">7</span>, <span class="hljs-number">12</span>, <span class="hljs-number">17</span>, <span class="hljs-number">22</span>, <span class="hljs-number">7</span>, <span class="hljs-number">12</span>, <span class="hljs-number">17</span>, <span class="hljs-number">22</span>, <span class="hljs-number">7</span>, <span class="hljs-number">12</span>, <span class="hljs-number">17</span>, <span class="hljs-number">22</span>, <span class="hljs-number">7</span>, <span class="hljs-number">12</span>, <span class="hljs-number">17</span>, <span class="hljs-number">22</span>,
		<span class="hljs-number">5</span>,  <span class="hljs-number">9</span>, <span class="hljs-number">14</span>, <span class="hljs-number">20</span>, <span class="hljs-number">5</span>,  <span class="hljs-number">9</span>, <span class="hljs-number">14</span>, <span class="hljs-number">20</span>, <span class="hljs-number">5</span>,  <span class="hljs-number">9</span>, <span class="hljs-number">14</span>, <span class="hljs-number">20</span>, <span class="hljs-number">5</span>,  <span class="hljs-number">9</span>, <span class="hljs-number">14</span>, <span class="hljs-number">20</span>,
		<span class="hljs-number">4</span>, <span class="hljs-number">11</span>, <span class="hljs-number">16</span>, <span class="hljs-number">23</span>, <span class="hljs-number">4</span>, <span class="hljs-number">11</span>, <span class="hljs-number">16</span>, <span class="hljs-number">23</span>, <span class="hljs-number">4</span>, <span class="hljs-number">11</span>, <span class="hljs-number">16</span>, <span class="hljs-number">23</span>, <span class="hljs-number">4</span>, <span class="hljs-number">11</span>, <span class="hljs-number">16</span>, <span class="hljs-number">23</span>,
		<span class="hljs-number">6</span>, <span class="hljs-number">10</span>, <span class="hljs-number">15</span>, <span class="hljs-number">21</span>, <span class="hljs-number">6</span>, <span class="hljs-number">10</span>, <span class="hljs-number">15</span>, <span class="hljs-number">21</span>, <span class="hljs-number">6</span>, <span class="hljs-number">10</span>, <span class="hljs-number">15</span>, <span class="hljs-number">21</span>, <span class="hljs-number">6</span>, <span class="hljs-number">10</span>, <span class="hljs-number">15</span>, <span class="hljs-number">21</span>
	];</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>PREPARE</p></div></div><div class="code"><div class="wrapper">	q = n / <span class="hljs-number">8</span> | <span class="hljs-number">0</span>;
	z = q * <span class="hljs-number">8</span>;
	u = n - z;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>append the bit &#39;1&#39; to the message</p></div></div><div class="code"><div class="wrapper">	<span class="hljs-keyword">if</span> (u &gt; <span class="hljs-number">0</span>) {
		last = bytes[q] &amp; (~<span class="hljs-number">0</span>) &lt;&lt; (<span class="hljs-number">7</span>-u);
	}
	<span class="hljs-keyword">else</span> {
		last = <span class="hljs-number">0x80</span>;
	}</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>initialize state</p></div></div><div class="code"><div class="wrapper">	h = [<span class="hljs-number">0x67452301</span>, <span class="hljs-number">0xefcdab89</span>, <span class="hljs-number">0x98badcfe</span>, <span class="hljs-number">0x10325476</span>];</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Process the message in successive 512-bit chunks:
break message into 512-bit chunks</p></div></div><div class="code"><div class="wrapper">	m = n / <span class="hljs-number">512</span> | <span class="hljs-number">0</span>;
	y = (n - <span class="hljs-number">512</span> * m) / <span class="hljs-number">8</span> | <span class="hljs-number">0</span>;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>offset in data</p></div></div><div class="code"><div class="wrapper">	o = <span class="hljs-number">0</span>;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>for each chunk</p></div></div><div class="code"><div class="wrapper">	<span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; m; ++j, o += <span class="hljs-number">64</span>) {
		call(h, k, r, bytes, o);
	}</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>last bytes + padding + length</p></div></div><div class="code"><div class="wrapper">	tail = [];</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>last bytes</p></div></div><div class="code"><div class="wrapper">	<span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; y; ++j) {
		tail.push(bytes[o + j]);
	}</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>special care taken for the very last byte which could
have been modified if n is not a multiple of 8</p></div></div><div class="code"><div class="wrapper">	tail.push(last);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>append 0 ≤ k &lt; 512 bits &#39;0&#39;, so that the resulting
message length (in bits) is congruent to 448 (mod 512)</p></div></div><div class="code"><div class="wrapper">	zeroes = (<span class="hljs-number">448</span> - (n + <span class="hljs-number">1</span>) % <span class="hljs-number">512</span>) / <span class="hljs-number">8</span> | <span class="hljs-number">0</span>;

	<span class="hljs-keyword">if</span> (zeroes &lt; <span class="hljs-number">0</span>) {</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>we need an additional block as there is
not enough space left to append
the length of the data in bits</p></div></div><div class="code"><div class="wrapper">		<span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; -zeroes; ++j) {
			tail.push(<span class="hljs-number">0</span>);
		}

		call(h, k, r, tail, <span class="hljs-number">0</span>);

		zeroes = <span class="hljs-number">448</span> / <span class="hljs-number">8</span>;
		tail = [];
	}</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>pad with zeroes</p></div></div><div class="code"><div class="wrapper">	<span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; zeroes; ++j) {
		tail.push(<span class="hljs-number">0</span>);
	}</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>append length of message (before preparation), in bits,
as 64-bit little-endian integer</p></div></div><div class="code"><div class="wrapper">	tail.push((n &gt;&gt;&gt;  <span class="hljs-number">0</span>) &amp; <span class="hljs-number">0xFF</span>);
	tail.push((n &gt;&gt;&gt;  <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xFF</span>);
	tail.push((n &gt;&gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFF</span>);
	tail.push((n &gt;&gt;&gt; <span class="hljs-number">24</span>) &amp; <span class="hljs-number">0xFF</span>);</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>JavaScript works with 32 bit integers.
tail.push((n &gt;&gt;&gt; 32) &amp; 0xFF);
tail.push((n &gt;&gt;&gt; 40) &amp; 0xFF);
tail.push((n &gt;&gt;&gt; 48) &amp; 0xFF);
tail.push((n &gt;&gt;&gt; 56) &amp; 0xFF);</p></div></div><div class="code"><div class="wrapper">	tail.push(<span class="hljs-number">0</span>);
	tail.push(<span class="hljs-number">0</span>);
	tail.push(<span class="hljs-number">0</span>);
	tail.push(<span class="hljs-number">0</span>);

	call(h, k, r, tail, <span class="hljs-number">0</span>);

	digest[<span class="hljs-number">0</span>]  = (h[<span class="hljs-number">0</span>] &gt;&gt;&gt;  <span class="hljs-number">0</span>) &amp; <span class="hljs-number">0xFF</span>;
	digest[<span class="hljs-number">1</span>]  = (h[<span class="hljs-number">0</span>] &gt;&gt;&gt;  <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xFF</span>;
	digest[<span class="hljs-number">2</span>]  = (h[<span class="hljs-number">0</span>] &gt;&gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFF</span>;
	digest[<span class="hljs-number">3</span>]  = (h[<span class="hljs-number">0</span>] &gt;&gt;&gt; <span class="hljs-number">24</span>) &amp; <span class="hljs-number">0xFF</span>;
	digest[<span class="hljs-number">4</span>]  = (h[<span class="hljs-number">1</span>] &gt;&gt;&gt;  <span class="hljs-number">0</span>) &amp; <span class="hljs-number">0xFF</span>;
	digest[<span class="hljs-number">5</span>]  = (h[<span class="hljs-number">1</span>] &gt;&gt;&gt;  <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xFF</span>;
	digest[<span class="hljs-number">6</span>]  = (h[<span class="hljs-number">1</span>] &gt;&gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFF</span>;
	digest[<span class="hljs-number">7</span>]  = (h[<span class="hljs-number">1</span>] &gt;&gt;&gt; <span class="hljs-number">24</span>) &amp; <span class="hljs-number">0xFF</span>;
	digest[<span class="hljs-number">8</span>]  = (h[<span class="hljs-number">2</span>] &gt;&gt;&gt;  <span class="hljs-number">0</span>) &amp; <span class="hljs-number">0xFF</span>;
	digest[<span class="hljs-number">9</span>]  = (h[<span class="hljs-number">2</span>] &gt;&gt;&gt;  <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xFF</span>;
	digest[<span class="hljs-number">10</span>] = (h[<span class="hljs-number">2</span>] &gt;&gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFF</span>;
	digest[<span class="hljs-number">11</span>] = (h[<span class="hljs-number">2</span>] &gt;&gt;&gt; <span class="hljs-number">24</span>) &amp; <span class="hljs-number">0xFF</span>;
	digest[<span class="hljs-number">12</span>] = (h[<span class="hljs-number">3</span>] &gt;&gt;&gt;  <span class="hljs-number">0</span>) &amp; <span class="hljs-number">0xFF</span>;
	digest[<span class="hljs-number">13</span>] = (h[<span class="hljs-number">3</span>] &gt;&gt;&gt;  <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xFF</span>;
	digest[<span class="hljs-number">14</span>] = (h[<span class="hljs-number">3</span>] &gt;&gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xFF</span>;
	digest[<span class="hljs-number">15</span>] = (h[<span class="hljs-number">3</span>] &gt;&gt;&gt; <span class="hljs-number">24</span>) &amp; <span class="hljs-number">0xFF</span>;

	<span class="hljs-keyword">return</span> digest;

};

exports.md5 = md5;</div></div></div></div></body></html>