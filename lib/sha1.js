'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});
exports.sha1 = sha1;

var _jsUint = require('@aureooms/js-uint32');

function cycle(h, w) {

	// initialize hash value for this chunk:
	var a = h[0];
	var b = h[1];
	var c = h[2];
	var d = h[3];
	var e = h[4];

	// Main loop:[35]
	// for j from 0 to 79
	for (var j = 0; j < 80; ++j) {

		var f = void 0,
		    k = void 0;

		// if 0 ≤ j ≤ 19 then
		if (0 <= j && j <= 19) {
			// f = (b and c) or ((not b) and d)
			f = b & c | ~b & d;
			k = 0x5A827999;
		}
		// else if 20 ≤ j ≤ 39
		else if (20 <= j && j <= 39) {
				// f = b xor c xor d
				f = b ^ c ^ d;
				k = 0x6ED9EBA1;
			}
			// else if 40 ≤ j ≤ 59
			else if (40 <= j && j <= 59) {
					// f = (b and c) or (b and d) or (c and d)
					f = b & c | b & d | c & d;
					k = 0x8F1BBCDC;
				}
				// else if 60 ≤ j ≤ 79
				else {
						// f = b xor c xor d
						f = b ^ c ^ d;
						k = 0xCA62C1D6;
					}

		// t = (a leftrotate 5) + f + e + k + w[j]
		var t = (0, _jsUint.add32)((0, _jsUint.add32)((0, _jsUint.rot32)(a, 5), f), (0, _jsUint.add32)((0, _jsUint.add32)(e, k), w[j]));
		e = d;
		d = c;
		// c = b leftrotate 30
		c = (0, _jsUint.rot32)(b, 30);
		b = a;
		a = t;
	}

	// Add this chunk's hash to result so far:
	h[0] = (0, _jsUint.add32)(h[0], a);
	h[1] = (0, _jsUint.add32)(h[1], b);
	h[2] = (0, _jsUint.add32)(h[2], c);
	h[3] = (0, _jsUint.add32)(h[3], d);
	h[4] = (0, _jsUint.add32)(h[4], e);
}

function call(h, data, o) {

	var w = new Array(80);

	// break chunk into sixteen 32-bit big-endian words w[i], 0 ≤ i ≤ 15
	for (var j = 0; j < 16; ++j) {
		w[j] = (0, _jsUint.big32)(data, o + j * 4);
	}

	// Extend the sixteen 32-bit words into eighty 32-bit words:
	// for j from 16 to 79
	for (var _j = 16; _j < 80; ++_j) {
		// w[j] = (w[j-3] xor w[j-8] xor w[j-14] xor w[j-16]) leftrotate 1
		var k = w[_j - 3] ^ w[_j - 8] ^ w[_j - 14] ^ w[_j - 16];
		w[_j] = (0, _jsUint.rot32)(k, 1);
	}

	cycle(h, w);
}

/**
 * SHA1
 */
function sha1(bytes, n, digest) {

	// PREPARE

	var q = n / 8 | 0;
	var z = q * 8;
	var u = n - z;

	// append the bit '1' to the message
	var last = void 0;
	if (u > 0) {
		last = bytes[q] & ~0 << 7 - u;
	} else {
		last = 0x80;
	}

	// Note 1: All variables are unsigned 32 bits and wrap modulo 2^32 when calculating
	// Note 2: All constants in this pseudo code are in big endian.
	// Within each word, the most significant byte is stored in the leftmost byte position

	// Initialize state:
	var h = [0x67452301, 0xEFCDAB89, 0x98BADCFE, 0x10325476, 0xC3D2E1F0];

	// Process the message in successive 512-bit chunks:
	// break message into 512-bit chunks

	var m = n / 512 | 0;
	var y = (n - 512 * m) / 8 | 0;

	// offset in data
	var o = 0;

	// for each chunk
	for (var j = 0; j < m; ++j, o += 64) {
		call(h, bytes, o);
	}

	// last bytes + padding + length
	var tail = [];

	// last bytes
	for (var _j2 = 0; _j2 < y; ++_j2) {
		tail.push(bytes[o + _j2]);
	}

	// special care taken for the very last byte which could
	// have been modified if n is not a multiple of 8
	tail.push(last);

	// append 0 ≤ k < 512 bits '0', so that the resulting
	// message length (in bits) is congruent to 448 (mod 512)
	var zeroes = (448 - (n + 1) % 512) / 8 | 0;

	if (zeroes < 0) {
		// we need an additional block as there is
		// not enough space left to append
		// the length of the data in bits

		for (var _j3 = 0; _j3 < -zeroes; ++_j3) {
			tail.push(0);
		}

		call(h, tail, 0);

		zeroes = 448 / 8;
		tail = [];
	}

	// pad with zeroes
	for (var _j4 = 0; _j4 < zeroes; ++_j4) {
		tail.push(0);
	}

	// append length of message (before preparation), in bits,
	// as 64-bit big-endian integer

	// JavaScript works with 32 bit integers.
	// tail.push((n >>> 56) & 0xFF);
	// tail.push((n >>> 48) & 0xFF);
	// tail.push((n >>> 40) & 0xFF);
	// tail.push((n >>> 32) & 0xFF);
	tail.push(0);
	tail.push(0);
	tail.push(0);
	tail.push(0);

	tail.push(n >>> 24 & 0xFF);
	tail.push(n >>> 16 & 0xFF);
	tail.push(n >>> 8 & 0xFF);
	tail.push(n >>> 0 & 0xFF);

	call(h, tail, 0);

	digest[0] = h[0] >>> 24 & 0xFF;
	digest[1] = h[0] >>> 16 & 0xFF;
	digest[2] = h[0] >>> 8 & 0xFF;
	digest[3] = h[0] >>> 0 & 0xFF;
	digest[4] = h[1] >>> 24 & 0xFF;
	digest[5] = h[1] >>> 16 & 0xFF;
	digest[6] = h[1] >>> 8 & 0xFF;
	digest[7] = h[1] >>> 0 & 0xFF;
	digest[8] = h[2] >>> 24 & 0xFF;
	digest[9] = h[2] >>> 16 & 0xFF;
	digest[10] = h[2] >>> 8 & 0xFF;
	digest[11] = h[2] >>> 0 & 0xFF;
	digest[12] = h[3] >>> 24 & 0xFF;
	digest[13] = h[3] >>> 16 & 0xFF;
	digest[14] = h[3] >>> 8 & 0xFF;
	digest[15] = h[3] >>> 0 & 0xFF;
	digest[16] = h[4] >>> 24 & 0xFF;
	digest[17] = h[4] >>> 16 & 0xFF;
	digest[18] = h[4] >>> 8 & 0xFF;
	digest[19] = h[4] >>> 0 & 0xFF;

	return digest;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9zaGExLmpzIl0sIm5hbWVzIjpbInNoYTEiLCJjeWNsZSIsImgiLCJ3IiwiYSIsImIiLCJjIiwiZCIsImUiLCJqIiwiZiIsImsiLCJ0IiwiY2FsbCIsImRhdGEiLCJvIiwiQXJyYXkiLCJieXRlcyIsIm4iLCJkaWdlc3QiLCJxIiwieiIsInUiLCJsYXN0IiwibSIsInkiLCJ0YWlsIiwicHVzaCIsInplcm9lcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7UUFvRmdCQSxJLEdBQUFBLEk7O0FBcEZoQjs7QUFFQSxTQUFTQyxLQUFULENBQWdCQyxDQUFoQixFQUFtQkMsQ0FBbkIsRUFBc0I7O0FBRXJCO0FBQ0EsS0FBSUMsSUFBSUYsRUFBRSxDQUFGLENBQVI7QUFDQSxLQUFJRyxJQUFJSCxFQUFFLENBQUYsQ0FBUjtBQUNBLEtBQUlJLElBQUlKLEVBQUUsQ0FBRixDQUFSO0FBQ0EsS0FBSUssSUFBSUwsRUFBRSxDQUFGLENBQVI7QUFDQSxLQUFJTSxJQUFJTixFQUFFLENBQUYsQ0FBUjs7QUFFQTtBQUNBO0FBQ0EsTUFBSyxJQUFJTyxJQUFJLENBQWIsRUFBZ0JBLElBQUksRUFBcEIsRUFBd0IsRUFBRUEsQ0FBMUIsRUFBNkI7O0FBRTVCLE1BQUlDLFVBQUo7QUFBQSxNQUFPQyxVQUFQOztBQUVBO0FBQ0EsTUFBRyxLQUFLRixDQUFMLElBQVVBLEtBQUssRUFBbEIsRUFBcUI7QUFDcEI7QUFDQUMsT0FBS0wsSUFBSUMsQ0FBTCxHQUFZLENBQUVELENBQUgsR0FBUUUsQ0FBdkI7QUFDQUksT0FBSSxVQUFKO0FBQ0E7QUFDRDtBQUxBLE9BTUssSUFBRyxNQUFNRixDQUFOLElBQVdBLEtBQUssRUFBbkIsRUFBc0I7QUFDMUI7QUFDQUMsUUFBSUwsSUFBSUMsQ0FBSixHQUFRQyxDQUFaO0FBQ0FJLFFBQUksVUFBSjtBQUNBO0FBQ0Q7QUFMSyxRQU1BLElBQUcsTUFBTUYsQ0FBTixJQUFXQSxLQUFLLEVBQW5CLEVBQXNCO0FBQzFCO0FBQ0FDLFNBQUtMLElBQUlD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QTdCO0FBQ0FpQixRQUFPLEVBQVAsSUFBY2pCLEVBQUUsQ0FBRixNQUFTLEVBQVYsR0FBZ0IsSUFBN0I7QUFDQWlCLFFBQU8sRUFBUCxJQUFjakIsRUFBRSxDQUFGLE1BQVMsRUFBVixHQUFnQixJQUE3QjtBQUNBaUIsUUFBTyxFQUFQLElBQWNqQixFQUFFLENBQUYsTUFBVSxDQUFYLEdBQWdCLElBQTdCO0FBQ0FpQixRQUFPLEVBQVAsSUFBY2pCLEVBQUUsQ0FBRixNQUFVLENBQVgsR0FBZ0IsSUFBN0I7QUFDQWlCLFFBQU8sRUFBUCxJQUFjakIsRUFBRSxDQUFGLE1BQVMsRUFBVixHQUFnQixJQUE3QjtBQUNBaUIsUUFBTyxFQUFQLElBQWNqQixFQUFFLENBQUYsTUFBUyxFQUFWLEdBQWdCLElBQTdCO0FBQ0FpQixRQUFPLEVBQVAsSUFBY2pCLEVBQUUsQ0FBRixNQUFVLENBQVgsR0FBZ0IsSUFBN0I7QUFDQWlCLFFBQU8sRUFBUCxJQUFjakIsRUFBRSxDQUFGLE1BQVUsQ0FBWCxHQUFnQixJQUE3Qjs7QUFFQSxRQUFPaUIsTUFBUDtBQUVBIiwiZmlsZSI6InNoYTEuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBiaWczMiAsIHJvdDMyICwgYWRkMzIgfSBmcm9tICdAYXVyZW9vbXMvanMtdWludDMyJyA7XG5cbmZ1bmN0aW9uIGN5Y2xlIChoLCB3KSB7XG5cblx0Ly8gaW5pdGlhbGl6ZSBoYXNoIHZhbHVlIGZvciB0aGlzIGNodW5rOlxuXHRsZXQgYSA9IGhbMF07XG5cdGxldCBiID0gaFsxXTtcblx0bGV0IGMgPSBoWzJdO1xuXHRsZXQgZCA9IGhbM107XG5cdGxldCBlID0gaFs0XTtcblxuXHQvLyBNYWluIGxvb3A6WzM1XVxuXHQvLyBmb3IgaiBmcm9tIDAgdG8gNzlcblx0Zm9yIChsZXQgaiA9IDA7IGogPCA4MDsgKytqKSB7XG5cblx0XHRsZXQgZiwgaztcblxuXHRcdC8vIGlmIDAg4omkIGog4omkIDE5IHRoZW5cblx0XHRpZigwIDw9IGogJiYgaiA8PSAxOSl7XG5cdFx0XHQvLyBmID0gKGIgYW5kIGMpIG9yICgobm90IGIpIGFuZCBkKVxuXHRcdFx0ZiA9IChiICYgYykgfCAoKH4gYikgJiBkKTtcblx0XHRcdGsgPSAweDVBODI3OTk5O1xuXHRcdH1cblx0XHQvLyBlbHNlIGlmIDIwIOKJpCBqIOKJpCAzOVxuXHRcdGVsc2UgaWYoMjAgPD0gaiAmJiBqIDw9IDM5KXtcblx0XHRcdC8vIGYgPSBiIHhvciBjIHhvciBkXG5cdFx0XHRmID0gYiBeIGMgXiBkO1xuXHRcdFx0ayA9IDB4NkVEOUVCQTE7XG5cdFx0fVxuXHRcdC8vIGVsc2UgaWYgNDAg4omkIGog4omkIDU5XG5cdFx0ZWxzZSBpZig0MCA8PSBqICYmIGogPD0gNTkpe1xuXHRcdFx0Ly8gZiA9IChiIGFuZCBjKSBvciAoYiBhbmQgZCkgb3IgKGMgYW5kIGQpXG5cdFx0XHRmID0gKGIgJiBjKSB8IChiICYgZCkgfCAoYyAmIGQpO1xuXHRcdFx0ayA9IDB4OEYxQkJDREM7XG5cdFx0fVxuXHRcdC8vIGVsc2UgaWYgNjAg4omkIGog4omkIDc5XG5cdFx0ZWxzZXtcblx0XHRcdC8vIGYgPSBiIHhvciBjIHhvciBkXG5cdFx0XHRmID0gYiBeIGMgXiBkO1xuXHRcdFx0ayA9IDB4Q0E2MkMxRDY7XG5cdFx0fVxuXG5cdFx0Ly8gdCA9IChhIGxlZnRyb3RhdGUgNSkgKyBmICsgZSArIGsgKyB3W2pdXG5cdFx0Y29uc3QgdCA9IGFkZDMyKGFkZDMyKHJvdDMyKGEsIDUpLCBmKSwgYWRkMzIoYWRkMzIoZSwgayksIHdbal0pKTtcblx0XHRlID0gZDtcblx0XHRkID0gYztcblx0XHQvLyBjID0gYiBsZWZ0cm90YXRlIDMwXG5cdFx0YyA9IHJvdDMyKGIsIDMwKTtcblx0XHRiID0gYTtcblx0XHRhID0gdDtcblx0fVxuXG5cdC8vIEFkZCB0aGlzIGNodW5rJ3MgaGFzaCB0byByZXN1bHQgc28gZmFyOlxuXHRoWzBdID0gYWRkMzIoaFswXSwgYSk7XG5cdGhbMV0gPSBhZGQzMihoWzFdLCBiKTtcblx0aFsyXSA9IGFkZDMyKGhbMl0sIGMpO1xuXHRoWzNdID0gYWRkMzIoaFszXSwgZCk7XG5cdGhbNF0gPSBhZGQzMihoWzRdLCBlKTtcbn1cblxuZnVuY3Rpb24gY2FsbCAoaCwgZGF0YSwgbykge1xuXG5cdGNvbnN0IHcgPSBuZXcgQXJyYXkoODApO1xuXG5cdC8vIGJyZWFrIGNodW5rIGludG8gc2l4dGVlbiAzMi1iaXQgYmlnLWVuZGlhbiB3b3JkcyB3W2ldLCAwIOKJpCBpIOKJpCAxNVxuXHRmb3IgKGxldCBqID0gMDsgaiA8IDE2OyArK2opIHtcblx0XHR3W2pdID0gYmlnMzIoZGF0YSwgbyArIGogKiA0KTtcblx0fVxuXG5cdC8vIEV4dGVuZCB0aGUgc2l4dGVlbiAzMi1iaXQgd29yZHMgaW50byBlaWdodHkgMzItYml0IHdvcmRzOlxuXHQvLyBmb3IgaiBmcm9tIDE2IHRvIDc5XG5cdGZvcihsZXQgaiA9IDE2OyBqIDwgODA7ICsrail7XG5cdFx0Ly8gd1tqXSA9ICh3W2otM10geG9yIHdbai04XSB4b3Igd1tqLTE0XSB4b3Igd1tqLTE2XSkgbGVmdHJvdGF0ZSAxXG5cdFx0Y29uc3QgayA9ICh3W2otM10gXiB3W2otOF0gXiB3W2otMTRdIF4gd1tqLTE2XSk7XG5cdFx0d1tqXSA9IHJvdDMyKGssIDEpO1xuXHR9XG5cblx0Y3ljbGUoaCwgdyk7XG5cbn1cblxuLyoqXG4gKiBTSEExXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzaGExIChieXRlcywgbiwgZGlnZXN0KSB7XG5cblx0Ly8gUFJFUEFSRVxuXG5cdGNvbnN0IHEgPSBuIC8gOCB8IDA7XG5cdGNvbnN0IHogPSBxICogODtcblx0Y29uc3QgdSA9IG4gLSB6O1xuXG5cdC8vIGFwcGVuZCB0aGUgYml0ICcxJyB0byB0aGUgbWVzc2FnZVxuXHRsZXQgbGFzdCA7XG5cdGlmICh1ID4gMCkge1xuXHRcdGxhc3QgPSBieXRlc1txXSAmICh+MCkgPDwgKDctdSk7XG5cdH1cblx0ZWxzZSB7XG5cdFx0bGFzdCA9IDB4ODA7XG5cdH1cblxuXHQvLyBOb3RlIDE6IEFsbCB2YXJpYWJsZXMgYXJlIHVuc2lnbmVkIDMyIGJpdHMgYW5kIHdyYXAgbW9kdWxvIDJeMzIgd2hlbiBjYWxjdWxhdGluZ1xuXHQvLyBOb3RlIDI6IEFsbCBjb25zdGFudHMgaW4gdGhpcyBwc2V1ZG8gY29kZSBhcmUgaW4gYmlnIGVuZGlhbi5cblx0Ly8gV2l0aGluIGVhY2ggd29yZCwgdGhlIG1vc3Qgc2lnbmlmaWNhbnQgYnl0ZSBpcyBzdG9yZWQgaW4gdGhlIGxlZnRtb3N0IGJ5dGUgcG9zaXRpb25cblxuXHQvLyBJbml0aWFsaXplIHN0YXRlOlxuXHRjb25zdCBoID0gWzB4Njc0NTIzMDEsIDB4RUZDREFCODksIDB4OThCQURDRkUsIDB4MTAzMjU0NzYsIDB4QzNEMkUxRjBdO1xuXG5cdC8vIFByb2Nlc3MgdGhlIG1lc3NhZ2UgaW4gc3VjY2Vzc2l2ZSA1MTItYml0IGNodW5rczpcblx0Ly8gYnJlYWsgbWVzc2FnZSBpbnRvIDUxMi1iaXQgY2h1bmtzXG5cblx0Y29uc3QgbSA9IG4gLyA1MTIgfCAwO1xuXHRjb25zdCB5ID0gKG4gLSA1MTIgKiBtKSAvIDggfCAwO1xuXG5cdC8vIG9mZnNldCBpbiBkYXRhXG5cdGxldCBvID0gMDtcblxuXHQvLyBmb3IgZWFjaCBjaHVua1xuXHRmb3IgKGxldCBqID0gMDsgaiA8IG07ICsraiwgbyArPSA2NCkge1xuXHRcdGNhbGwoaCwgYnl0ZXMsIG8pO1xuXHR9XG5cblx0Ly8gbGFzdCBieXRlcyArIHBhZGRpbmcgKyBsZW5ndGhcblx0bGV0IHRhaWwgPSBbXTtcblxuXHQvLyBsYXN0IGJ5dGVzXG5cdGZvciAobGV0IGogPSAwOyBqIDwgeTsgKytqKSB7XG5cdFx0dGFpbC5wdXNoKGJ5dGVzW28gKyBqXSk7XG5cdH1cblxuXHQvLyBzcGVjaWFsIGNhcmUgdGFrZW4gZm9yIHRoZSB2ZXJ5IGxhc3QgYnl0ZSB3aGljaCBjb3VsZFxuXHQvLyBoYXZlIGJlZW4gbW9kaWZpZWQgaWYgbiBpcyBub3QgYSBtdWx0aXBsZSBvZiA4XG5cdHRhaWwucHVzaChsYXN0KTtcblxuXG5cdC8vIGFwcGVuZCAwIOKJpCBrIDwgNTEyIGJpdHMgJzAnLCBzbyB0aGF0IHRoZSByZXN1bHRpbmdcblx0Ly8gbWVzc2FnZSBsZW5ndGggKGluIGJpdHMpIGlzIGNvbmdydWVudCB0byA0NDggKG1vZCA1MTIpXG5cdGxldCB6ZXJvZXMgPSAoNDQ4IC0gKG4gKyAxKSAlIDUxMikgLyA4IHwgMDtcblxuXHRpZiAoemVyb2VzIDwgMCkge1xuXHRcdC8vIHdlIG5lZWQgYW4gYWRkaXRpb25hbCBibG9jayBhcyB0aGVyZSBpc1xuXHRcdC8vIG5vdCBlbm91Z2ggc3BhY2UgbGVmdCB0byBhcHBlbmRcblx0XHQvLyB0aGUgbGVuZ3RoIG9mIHRoZSBkYXRhIGluIGJpdHNcblxuXHRcdGZvciAobGV0IGogPSAwOyBqIDwgLXplcm9lczsgKytqKSB7XG5cdFx0XHR0YWlsLnB1c2goMCk7XG5cdFx0fVxuXG5cdFx0Y2FsbChoLCB0YWlsLCAwKTtcblxuXHRcdHplcm9lcyA9IDQ0OCAvIDg7XG5cdFx0dGFpbCA9IFtdO1xuXHR9XG5cblxuXHQvLyBwYWQgd2l0aCB6ZXJvZXNcblx0Zm9yIChsZXQgaiA9IDA7IGogPCB6ZXJvZXM7ICsraikge1xuXHRcdHRhaWwucHVzaCgwKTtcblx0fVxuXG5cdC8vIGFwcGVuZCBsZW5ndGggb2YgbWVzc2FnZSAoYmVmb3JlIHByZXBhcmF0aW9uKSwgaW4gYml0cyxcblx0Ly8gYXMgNjQtYml0IGJpZy1lbmRpYW4gaW50ZWdlclxuXG5cdC8vIEphdmFTY3JpcHQgd29ya3Mgd2l0aCAzMiBiaXQgaW50ZWdlcnMuXG5cdC8vIHRhaWwucHVzaCgobiA+Pj4gNTYpICYgMHhGRik7XG5cdC8vIHRhaWwucHVzaCgobiA+Pj4gNDgpICYgMHhGRik7XG5cdC8vIHRhaWwucHVzaCgobiA+Pj4gNDApICYgMHhGRik7XG5cdC8vIHRhaWwucHVzaCgobiA+Pj4gMzIpICYgMHhGRik7XG5cdHRhaWwucHVzaCgwKTtcblx0dGFpbC5wdXNoKDApO1xuXHR0YWlsLnB1c2goMCk7XG5cdHRhaWwucHVzaCgwKTtcblxuXHR0YWlsLnB1c2goKG4gPj4+IDI0KSAmIDB4RkYpO1xuXHR0YWlsLnB1c2goKG4gPj4+IDE2KSAmIDB4RkYpO1xuXHR0YWlsLnB1c2goKG4gPj4+ICA4KSAmIDB4RkYpO1xuXHR0YWlsLnB1c2goKG4gPj4+ICAwKSAmIDB4RkYpO1xuXG5cdGNhbGwoaCwgdGFpbCwgMCk7XG5cblx0ZGlnZXN0WzBdICA9IChoWzBdID4+PiAyNCkgJiAweEZGO1xuXHRkaWdlc3RbMV0gID0gKGhbMF0gPj4+IDE2KSAmIDB4RkY7XG5cdGRpZ2VzdFsyXSAgPSAoaFswXSA+Pj4gIDgpICYgMHhGRjtcblx0ZGlnZXN0WzNdICA9IChoWzBdID4+PiAgMCkgJiAweEZGO1xuXHRkaWdlc3RbNF0gID0gKGhbMV0gPj4+IDI0KSAmIDB4RkY7XG5cdGRpZ2VzdFs1XSAgPSAoaFsxXSA+Pj4gMTYpICYgMHhGRjtcblx0ZGlnZXN0WzZdICA9IChoWzFdID4+PiAgOCkgJiAweEZGO1xuXHRkaWdlc3RbN10gID0gKGhbMV0gPj4+ICAwKSAmIDB4RkY7XG5cdGRpZ2VzdFs4XSAgPSAoaFsyXSA+Pj4gMjQpICYgMHhGRjtcblx0ZGlnZXN0WzldICA9IChoWzJdID4+PiAxNikgJiAweEZGO1xuXHRkaWdlc3RbMTBdID0gKGhbMl0gPj4+ICA4KSAmIDB4RkY7XG5cdGRpZ2VzdFsxMV0gPSAoaFsyXSA+Pj4gIDApICYgMHhGRjtcblx0ZGlnZXN0WzEyXSA9IChoWzNdID4+PiAyNCkgJiAweEZGO1xuXHRkaWdlc3RbMTNdID0gKGhbM10gPj4+IDE2KSAmIDB4RkY7XG5cdGRpZ2VzdFsxNF0gPSAoaFszXSA+Pj4gIDgpICYgMHhGRjtcblx0ZGlnZXN0WzE1XSA9IChoWzNdID4+PiAgMCkgJiAweEZGO1xuXHRkaWdlc3RbMTZdID0gKGhbNF0gPj4+IDI0KSAmIDB4RkY7XG5cdGRpZ2VzdFsxN10gPSAoaFs0XSA+Pj4gMTYpICYgMHhGRjtcblx0ZGlnZXN0WzE4XSA9IChoWzRdID4+PiAgOCkgJiAweEZGO1xuXHRkaWdlc3RbMTldID0gKGhbNF0gPj4+ICAwKSAmIDB4RkY7XG5cblx0cmV0dXJuIGRpZ2VzdDtcblxufVxuIl19