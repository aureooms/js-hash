<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/hash/sha512.js | aureooms/js-hash API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
<script data-ice="userScript" src="user/script/0-header.js"></script>
<link data-ice="userStyle" rel="stylesheet" href="user/css/0-style.css">
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  <a href="test.html" data-ice="testLink">Test</a>
  <a data-ice="repoURL" href="https://github.com/aureooms/js-hash.git" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">hash</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-md5">md5</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-md5fast">md5fast</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-sha1">sha1</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-sha224">sha224</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-sha256">sha256</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-sha384">sha384</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-sha512">sha512</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">uint32</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-big32">big32</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-lil32">lil32</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-rot32">rot32</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-add32">add32</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">uint64</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-add64">add64</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-big64">big64</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-rot64">rot64</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-xor64">xor64</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-and64">and64</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-not64">not64</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-sh64">sh64</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/hash/sha512.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import { add64 , and64 , xor64 , rot64 , not64 , big64 , sh64 } from &apos;../uint64&apos; ;

// Initialize table of round constants
// (first 64 bits of the fractional parts of the cube roots of the first 80 primes 2..311):
const k = [
	[0x428a2f98, 0xd728ae22], [0x71374491, 0x23ef65cd], [0xb5c0fbcf, 0xec4d3b2f], [0xe9b5dba5, 0x8189dbbc],
	[0x3956c25b, 0xf348b538], [0x59f111f1, 0xb605d019], [0x923f82a4, 0xaf194f9b], [0xab1c5ed5, 0xda6d8118],
	[0xd807aa98, 0xa3030242], [0x12835b01, 0x45706fbe], [0x243185be, 0x4ee4b28c], [0x550c7dc3, 0xd5ffb4e2],
	[0x72be5d74, 0xf27b896f], [0x80deb1fe, 0x3b1696b1], [0x9bdc06a7, 0x25c71235], [0xc19bf174, 0xcf692694],
	[0xe49b69c1, 0x9ef14ad2], [0xefbe4786, 0x384f25e3], [0x0fc19dc6, 0x8b8cd5b5], [0x240ca1cc, 0x77ac9c65],
	[0x2de92c6f, 0x592b0275], [0x4a7484aa, 0x6ea6e483], [0x5cb0a9dc, 0xbd41fbd4], [0x76f988da, 0x831153b5],
	[0x983e5152, 0xee66dfab], [0xa831c66d, 0x2db43210], [0xb00327c8, 0x98fb213f], [0xbf597fc7, 0xbeef0ee4],
	[0xc6e00bf3, 0x3da88fc2], [0xd5a79147, 0x930aa725], [0x06ca6351, 0xe003826f], [0x14292967, 0x0a0e6e70],
	[0x27b70a85, 0x46d22ffc], [0x2e1b2138, 0x5c26c926], [0x4d2c6dfc, 0x5ac42aed], [0x53380d13, 0x9d95b3df],
	[0x650a7354, 0x8baf63de], [0x766a0abb, 0x3c77b2a8], [0x81c2c92e, 0x47edaee6], [0x92722c85, 0x1482353b],
	[0xa2bfe8a1, 0x4cf10364], [0xa81a664b, 0xbc423001], [0xc24b8b70, 0xd0f89791], [0xc76c51a3, 0x0654be30],
	[0xd192e819, 0xd6ef5218], [0xd6990624, 0x5565a910], [0xf40e3585, 0x5771202a], [0x106aa070, 0x32bbd1b8],
	[0x19a4c116, 0xb8d2d0c8], [0x1e376c08, 0x5141ab53], [0x2748774c, 0xdf8eeb99], [0x34b0bcb5, 0xe19b48a8],
	[0x391c0cb3, 0xc5c95a63], [0x4ed8aa4a, 0xe3418acb], [0x5b9cca4f, 0x7763e373], [0x682e6ff3, 0xd6b2b8a3],
	[0x748f82ee, 0x5defb2fc], [0x78a5636f, 0x43172f60], [0x84c87814, 0xa1f0ab72], [0x8cc70208, 0x1a6439ec],
	[0x90befffa, 0x23631e28], [0xa4506ceb, 0xde82bde9], [0xbef9a3f7, 0xb2c67915], [0xc67178f2, 0xe372532b],
	[0xca273ece, 0xea26619c], [0xd186b8c7, 0x21c0c207], [0xeada7dd6, 0xcde0eb1e], [0xf57d4f7f, 0xee6ed178],
	[0x06f067aa, 0x72176fba], [0x0a637dc5, 0xa2c898a6], [0x113f9804, 0xbef90dae], [0x1b710b35, 0x131c471b],
	[0x28db77f5, 0x23047d84], [0x32caab7b, 0x40c72493], [0x3c9ebe0a, 0x15c9bebc], [0x431d67c4, 0x9c100d4c],
	[0x4cc5d4be, 0xcb3e42b6], [0x597f299c, 0xfc657e2a], [0x5fcb6fab, 0x3ad6faec], [0x6c44198c, 0x4a475817]
] ;

function cycle (state, w) {

	// initialize hash value for this chunk:
	let a = state[0];
	let b = state[1];
	let c = state[2];
	let d = state[3];
	let e = state[4];
	let f = state[5];
	let g = state[6];
	let h = state[7];

	// Main loop:
	// for j from 0 to 79
	for (let j = 0; j &lt; 80; ++j) {
		// S1 := (e rightrotate 14) xor (e rightrotate 18) xor (e rightrotate 41)
		const s1 = xor64(xor64(rot64(e, 14), rot64(e, 18)), rot64(e, 41));
		// ch := (e and f) xor ((not e) and g)
		const ch = xor64(and64(e, f), and64(not64(e), g));
		// temp := h + S1 + ch + k[j] + w[j]
		let temp = add64(add64(h, s1), add64(add64(ch, k[j]), w[j]));
		// d := d + temp;
		d = add64(d, temp);
		// S0 := (a rightrotate 28) xor (a rightrotate 34) xor (a rightrotate 39)
		const s0 = xor64(xor64(rot64(a, 28), rot64(a, 34)), rot64(a, 39));
		// maj := (a and (b xor c)) xor (b and c)
		const maj = xor64(and64(a, xor64(b, c)), and64(b, c));
		// temp := temp + S0 + maj
		temp = add64(add64(temp, s0), maj);

		h = g;
		g = f;
		f = e;
		e = d;
		d = c;
		c = b;
		b = a;
		a = temp;
	}

	// Add this chunk&apos;s hash to result so far:
	state[0] = add64(state[0], a);
	state[1] = add64(state[1], b);
	state[2] = add64(state[2], c);
	state[3] = add64(state[3], d);
	state[4] = add64(state[4], e);
	state[5] = add64(state[5], f);
	state[6] = add64(state[6], g);
	state[7] = add64(state[7], h);
}

function call (h, data, o) {

	const w = new Array(80);

	// break chunk into sixteen 64-bit big-endian words w[i], 0 &#x2264; i &#x2264; 15
	for (let j = 0; j &lt; 16; ++j) {
		w[j] = big64(data, o + j * 8);
	}

	// Extend the sixteen 64-bit words into 80 64-bit words:
	// for j from 16 to 79
	for (let j = 16; j &lt; 80; ++j) {
		// s0 := (w[j-15] rightrotate 1) xor (w[j-15] rightrotate 8) xor (w[j-15] rightshift 7)
		const s0 = xor64(xor64(rot64(w[j-15],  1), rot64(w[j-15],  8)), sh64(w[j-15], 7));
		// s1 := (w[j-2] rightrotate 19) xor (w[j-2] rightrotate 61) xor (w[j-2] rightshift 6)
		const s1 = xor64(xor64(rot64(w[j- 2], 19), rot64(w[j- 2], 61)), sh64(w[j- 2], 6));
		// w[j] := w[j-16] + s0 + w[j-7] + s1
		w[j] = add64(add64(w[j-16], s0), add64(w[j-7], s1));
	}

	cycle(h, w);

}


/**
 * SHA-512
 */
export function sha512 (bytes, n, digest) {

	// Note 1: All variables are unsigned 64 bits and wrap modulo 2^64 when calculating
	// Note 2: All constants in this pseudo code are big endian

	// Initialize variables
	// (first 64 bits of the fractional parts of the square roots of the first 8 primes 2..19):
	const h = [
		[0x6a09e667, 0xf3bcc908],
		[0xbb67ae85, 0x84caa73b],
		[0x3c6ef372, 0xfe94f82b],
		[0xa54ff53a, 0x5f1d36f1],
		[0x510e527f, 0xade682d1],
		[0x9b05688c, 0x2b3e6c1f],
		[0x1f83d9ab, 0xfb41bd6b],
		[0x5be0cd19, 0x137e2179]
	];

	// PREPARE

	const q = n / 8 | 0;
	const z = q * 8;
	const u = n - z;

	// append the bit &apos;1&apos; to the message
	let last ;
	if (u &gt; 0) {
		last = bytes[q] &amp; (~0) &lt;&lt; (7-u);
	}
	else {
		last = 0x80;
	}


	// Process the message in successive 1024-bit chunks:
	// break message into 1024-bit chunks

	const m = n / 1024 | 0;
	const y = (n - 1024 * m) / 8 | 0;

	// offset in data
	let o = 0;

	// for each chunk
	for (let j = 0; j &lt; m; ++j, o += 128) {
		call(h, bytes, o);
	}

	// last bytes + padding + length
	let tail = [];

	// last bytes
	for (let j = 0; j &lt; y; ++j) {
		tail.push(bytes[o + j]);
	}

	// special care taken for the very last byte which could
	// have been modified if n is not a multiple of 8
	tail.push(last);


	// append 0 &#x2264; k &lt; 1024 bits &apos;0&apos;, so that the resulting
	// message length (in bits) is congruent to 896 (mod 1024)
	const g = (896 - (n + 1) % 1024);
	let zeroes = g / 8 | 0;

	if (g &lt; 0) {
		// we need an additional block as there is
		// not enough space left to append
		// the length of the data in bits

		for (let j = 0; j &lt; -zeroes; ++j) {
			tail.push(0);
		}

		call(h, tail, 0);

		zeroes = 896 / 8;
		tail = [];
	}


	// pad with zeroes
	for (let j = 0; j &lt; zeroes; ++j) {
		tail.push(0);
	}

	// append length of message (before preparation), in bits,
	// as 128-bit big-endian integer

	// JavaScript works with 32 bit integers.
	// tail.push((n &gt;&gt;&gt; 124) &amp; 0xff);
	// tail.push((n &gt;&gt;&gt; 116) &amp; 0xff);
	// tail.push((n &gt;&gt;&gt; 108) &amp; 0xff);
	// tail.push((n &gt;&gt;&gt; 96) &amp; 0xff);
	// tail.push((n &gt;&gt;&gt; 88) &amp; 0xff);
	// tail.push((n &gt;&gt;&gt; 80) &amp; 0xff);
	// tail.push((n &gt;&gt;&gt; 72) &amp; 0xff);
	// tail.push((n &gt;&gt;&gt; 64) &amp; 0xff);
	// tail.push((n &gt;&gt;&gt; 56) &amp; 0xff);
	// tail.push((n &gt;&gt;&gt; 48) &amp; 0xff);
	// tail.push((n &gt;&gt;&gt; 40) &amp; 0xff);
	// tail.push((n &gt;&gt;&gt; 32) &amp; 0xff);
	tail.push(0);
	tail.push(0);
	tail.push(0);
	tail.push(0);
	tail.push(0);
	tail.push(0);
	tail.push(0);
	tail.push(0);
	tail.push(0);
	tail.push(0);
	tail.push(0);
	tail.push(0);

	tail.push((n &gt;&gt;&gt; 24) &amp; 0xff);
	tail.push((n &gt;&gt;&gt; 16) &amp; 0xff);
	tail.push((n &gt;&gt;&gt;  8) &amp; 0xff);
	tail.push((n &gt;&gt;&gt;  0) &amp; 0xff);

	call(h, tail, 0);

	for (let i = 0, j = 0; j &lt; 8; ++j) {
		digest[i] = (h[j][0] &gt;&gt;&gt; 24) &amp; 0xff;
		++i;
		digest[i] = (h[j][0] &gt;&gt;&gt; 16) &amp; 0xff;
		++i;
		digest[i] = (h[j][0] &gt;&gt;&gt;  8) &amp; 0xff;
		++i;
		digest[i] = (h[j][0] &gt;&gt;&gt;  0) &amp; 0xff;
		++i;
		digest[i] = (h[j][1] &gt;&gt;&gt; 24) &amp; 0xff;
		++i;
		digest[i] = (h[j][1] &gt;&gt;&gt; 16) &amp; 0xff;
		++i;
		digest[i] = (h[j][1] &gt;&gt;&gt;  8) &amp; 0xff;
		++i;
		digest[i] = (h[j][1] &gt;&gt;&gt;  0) &amp; 0xff;
		++i;
	}

	return digest;

}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.8)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
